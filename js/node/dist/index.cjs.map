{"version":3,"file":"index.cjs","sources":["../src/utils.js","../src/api.js","../src/EventTracker.js"],"sourcesContent":["export const encodeToBase64 = (str) => {\n  return btoa(str);\n};\n","import { encodeToBase64 } from \"./utils\";\n\nconst INGESTOR_URL = \"https://events.userlens.io\";\n\nexport const track = (teamUuid, body) => {\n  const encodedTeamUuid = encodeToBase64(`${teamUuid}:`);\n\n  return fetch(`${INGESTOR_URL}/event`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Basic ${encodedTeamUuid}`,\n    },\n    body: JSON.stringify(body),\n  });\n};\n","import { track } from \"./api\";\n\nclass EventTracker {\n  constructor(writeCode) {\n    if (!writeCode) {\n      console.error(\n        \"Userlens EventTracker error: missing writeCode or userId.\"\n      );\n    }\n\n    this.writeCode = writeCode;\n  }\n\n  #validateTraits(traits) {\n    return typeof traits === \"object\";\n  }\n\n  identifyUser(userId, traits = {}) {\n    if (!userId) {\n      try {\n        console.error(\n          \"Userlens identifyUser error: User ID is required. Received:\",\n          userId\n        );\n      } catch (err) {\n        console.error(\"Userlens identifyUser error:\", err);\n      }\n      return Promise.resolve(); // Avoid returning undefined\n    }\n\n    if (!this.#validateTraits(traits)) {\n      console.error(\n        \"Userlens identifyUser error: Invalid traits object:\",\n        traits\n      );\n      return Promise.resolve();\n    }\n\n    return track(this.writeCode, {\n      type: \"identify\",\n      userId,\n      traits,\n    }).catch((err) => {\n      console.error(\"Userlens identifyUser error:\", err);\n    });\n  }\n\n  trackEvent(userId, eventName = \"\", traits = {}) {\n    if (!eventName) {\n      console.error(\"Userlens trackEvent error: Event name is required\");\n      return Promise.resolve();\n    }\n\n    if (!userId) {\n      console.error(\"Userlens trackEvent error: User ID is required\");\n      return Promise.resolve();\n    }\n\n    return Promise.all([\n      track(this.writeCode, {\n        type: \"track\",\n        userId,\n        event: eventName,\n        timestamp: new Date().toISOString(),\n        source: \"userlens-analytics-sdk-node\",\n      }).catch((err) => {\n        console.error(\"Userlens trackEvent error:\", err);\n      }),\n\n      this.identifyUser(userId, traits).catch((err) => {\n        console.error(\"Userlens trackEvent error:\", err);\n      }),\n    ]);\n  }\n}\n\nexport default EventTracker;\n"],"names":[],"mappings":"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"}